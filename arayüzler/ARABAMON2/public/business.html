<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>İşletme Detayları - Arabamon</title>
    <link rel="stylesheet" href="/css/style.css">
    <!-- API JS -->
    <script src="/js/api.js"></script>
    <style>
        :root {
            --primary-color: #0066cc;
            --secondary-color: #ff6600;
            --dark-color: #333333;
            --light-color: #f4f4f4;
            --danger-color: #dc3545;
            --success-color: #28a745;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background-color: #f8f9fa;
            color: #333;
        }

        a {
            text-decoration: none;
            color: var(--primary-color);
        }

        ul {
            list-style: none;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* Navbar */
        .navbar {
            background-color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 1rem 0;
            margin-bottom: 2rem;
        }

        .navbar .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar-brand a {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .navbar-links {
            display: flex;
            margin: 0;
            padding: 0;
        }

        .navbar-links li {
            margin-left: 1.5rem;
        }

        .navbar-links li a {
            color: var(--dark-color);
            transition: color 0.3s;
        }

        .navbar-links li a:hover, 
        .navbar-links li a.active {
            color: var(--primary-color);
        }

        /* Business Detail Styles */
        .business-detail {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .business-header {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #eee;
        }

        .business-header h1 {
            font-size: 2rem;
            color: var(--primary-color);
            margin-right: 1rem;
            margin-bottom: 0.5rem;
        }

        .business-rating {
            display: flex;
            align-items: center;
            color: #666;
        }

        .rating-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-right: 0.5rem;
        }

        .rating-stars {
            margin-right: 0.5rem;
        }

        .star {
            color: #ffcc00;
            margin-right: -3px;
        }

        .star.empty {
            color: #ddd;
        }

        .reviews-count {
            color: #666;
            font-size: 0.9rem;
        }

        .business-info {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
        }

        @media (max-width: 768px) {
            .business-info {
                grid-template-columns: 1fr;
            }
        }

        .business-description {
            margin-bottom: 1.5rem;
            line-height: 1.8;
        }

        .business-categories {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .category-tag {
            background-color: var(--light-color);
            padding: 0.3rem 0.6rem;
            border-radius: 20px;
            font-size: 0.8rem;
            color: var(--dark-color);
        }

        .business-contact {
            background-color: var(--light-color);
            padding: 1.5rem;
            border-radius: 8px;
        }

        .contact-item {
            margin-bottom: 1rem;
        }

        .contact-item:last-child {
            margin-bottom: 0;
        }

        .contact-item strong {
            display: block;
            margin-bottom: 0.3rem;
            color: var(--dark-color);
        }

        .contact-item p {
            color: #666;
        }

        /* Services Styles */
        .business-services,
        .appointment-section,
        .reviews-section {
            margin-bottom: 3rem;
        }

        .business-services h2,
        .appointment-section h2,
        .reviews-section h2 {
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            color: var(--primary-color);
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--light-color);
        }

        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .service-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            transition: transform 0.3s;
        }

        .service-card:hover {
            transform: translateY(-5px);
        }

        .service-card h3 {
            font-size: 1.3rem;
            margin-bottom: 1rem;
            color: var(--dark-color);
        }

        .service-card p {
            color: #666;
            margin-bottom: 1rem;
        }

        .service-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .service-price {
            font-weight: bold;
            color: var(--primary-color);
        }

        .service-duration {
            color: #666;
        }

        /* Appointment Styles */
        .selected-service {
            background-color: var(--light-color);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }

        .selected-service-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .selected-service-info h4 {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: var(--dark-color);
        }

        .service-details {
            display: flex;
            gap: 1rem;
            font-size: 0.9rem;
        }

        .detail-price {
            font-weight: bold;
            color: var(--primary-color);
        }

        .detail-duration {
            color: #666;
        }

        .time-slots-container {
            margin: 1.5rem 0;
        }

        .time-slots-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 0.8rem;
            margin-top: 0.8rem;
        }

        .time-slot {
            position: relative;
        }

        .time-slot input[type="radio"] {
            display: none;
        }

        .time-slot label {
            display: block;
            padding: 0.6rem;
            text-align: center;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .time-slot label:hover {
            border-color: var(--primary-color);
        }

        .time-slot input[type="radio"]:checked + label {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .time-slot.unavailable label {
            background-color: #f8f9fa;
            color: #aaa;
            cursor: not-allowed;
            text-decoration: line-through;
        }

        /* Review Styles */
        .review-form-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .rating-input {
            display: flex;
            flex-direction: row-reverse;
            justify-content: flex-end;
            margin-bottom: 1rem;
        }

        .rating-input input[type="radio"] {
            display: none;
        }

        .rating-input label {
            display: inline-block;
            padding: 0.5rem;
            font-size: 1.5rem;
            color: #ddd;
            cursor: pointer;
            transition: color 0.3s;
        }

        .rating-input label:hover,
        .rating-input label:hover ~ label,
        .rating-input input[type="radio"]:checked ~ label {
            color: #ffcc00;
        }

        .review-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .review-author {
            font-weight: bold;
            color: var(--dark-color);
            margin-right: 1rem;
        }

        .review-rating {
            margin-right: 1rem;
        }

        .review-date {
            color: #888;
            font-size: 0.9rem;
        }

        .review-content {
            color: #666;
            line-height: 1.6;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: var(--dark-color);
        }

        .form-group input[type="text"],
        .form-group input[type="date"],
        .form-group input[type="email"],
        .form-group textarea {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            font-family: inherit;
        }

        .form-group textarea {
            resize: vertical;
        }

        .form-group small {
            display: block;
            margin-top: 0.5rem;
            color: #888;
            font-size: 0.8rem;
        }

        /* Button Styles */
        .btn {
            display: inline-block;
            padding: 0.8rem 1.5rem;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s ease;
            font-size: 1rem;
            text-align: center;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #0055b3;
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover {
            background-color: #e55c00;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
        }

        .btn-outline:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        .btn:disabled {
            background-color: #aaa;
            cursor: not-allowed;
        }

        /* Login Required */
        .login-required {
            background-color: var(--light-color);
            padding: 2rem;
            text-align: center;
            border-radius: 8px;
        }

        .login-required p {
            margin-bottom: 1.5rem;
            color: #666;
        }

        .login-required .btn {
            margin: 0 0.5rem;
        }

        /* Loading and Alerts */
        .loading-spinner {
            width: 40px;
            height: 40px;
            margin: 2rem auto;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }

        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
        }

        .alert-warning {
            background-color: #fff3cd;
            color: #856404;
        }

        /* Footer */
        footer {
            background-color: var(--dark-color);
            color: white;
            padding: 3rem 0 1rem;
            margin-top: 4rem;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .footer-section h3 {
            margin-bottom: 1rem;
            font-size: 1.2rem;
            color: #fff;
        }

        .footer-section p {
            margin-bottom: 0.5rem;
            color: #ddd;
        }

        .footer-section ul li {
            margin-bottom: 0.5rem;
        }

        .footer-section a {
            color: #ddd;
            transition: color 0.3s;
        }

        .footer-section a:hover {
            color: white;
        }

        .footer-bottom {
            text-align: center;
            padding-top: 1rem;
            border-top: 1px solid #555;
            color: #aaa;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .navbar .container {
                flex-direction: column;
            }
            
            .navbar-links {
                margin-top: 1rem;
            }
            
            .navbar-links li {
                margin: 0 0.5rem;
            }
            
            .business-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .business-rating {
                margin-top: 1rem;
            }
            
            .review-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .review-author, .review-rating {
                margin-bottom: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="container">
                <div class="navbar-brand">
                    <a href="/">Arabamon</a>
                </div>
                <ul class="navbar-links">
                    <li><a href="/">Ana Sayfa</a></li>
                    <li><a href="/businesses.html">İşletmeler</a></li>
                    <li><a href="/about.html">Hakkımızda</a></li>
                </ul>
                <ul class="navbar-links navbar-right">
                    <li><a href="/login.html">Giriş</a></li>
                    <li><a href="/register.html">Kayıt Ol</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <div class="container">
        <div class="alert-container"></div>
        
        <div class="loading-spinner" id="loading-spinner"></div>
        
        <div class="business-detail" id="business-detail">
            <!-- İşletme detayları buraya yüklenecek -->
        </div>
        
        <div class="business-services" id="business-services">
            <h2>Verilen Hizmetler</h2>
            <div class="services-container" id="services-container">
                <!-- Hizmetler buraya yüklenecek -->
            </div>
        </div>
        
        <div class="appointment-section" id="appointment-section">
            <h2>Randevu Al</h2>
            <div id="appointment-form-container">
                <!-- Randevu formu buraya yüklenecek -->
            </div>
        </div>
        
        <div class="reviews-section">
            <h2>Değerlendirmeler</h2>
            <div class="review-form-container" id="review-form-container">
                <!-- Değerlendirme formu buraya yüklenecek -->
            </div>
            <div class="reviews-container" id="reviews-container">
                <!-- Değerlendirmeler buraya yüklenecek -->
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Arabamon</h3>
                    <p>Araç bakım ve servis hizmetleri platformu.</p>
                </div>
                <div class="footer-section">
                    <h3>Hızlı Linkler</h3>
                    <ul>
                        <li><a href="/">Ana Sayfa</a></li>
                        <li><a href="/businesses.html">İşletmeler</a></li>
                        <li><a href="/about.html">Hakkımızda</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>İletişim</h3>
                    <p>info@arabamon.com</p>
                    <p>+90 555 123 4567</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2023 Arabamon. Tüm hakları saklıdır.</p>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const businessId = urlParams.get('id');
            
            if (!businessId) {
                window.location.href = '/businesses.html';
                return;
            }
            
            const businessDetailEl = document.getElementById('business-detail');
            const servicesContainerEl = document.getElementById('services-container');
            const appointmentFormContainerEl = document.getElementById('appointment-form-container');
            const reviewFormContainerEl = document.getElementById('review-form-container');
            const reviewsContainerEl = document.getElementById('reviews-container');
            const loadingSpinner = document.getElementById('loading-spinner');
            const alertContainer = document.querySelector('.alert-container');
            
            // Demo verileri
            const demoBusiness = {
                id: businessId,
                name: 'Merkez Oto Servis',
                description: 'Tüm araç markalarına profesyonel bakım ve onarım hizmeti sunuyoruz. 20 yıllık tecrübemizle aracınızın her türlü bakım, onarım ve parça değişimini en kaliteli şekilde yapıyoruz. Müşteri memnuniyetini en üst seviyede tutmak için çalışıyoruz.',
                address: 'Atatürk Cad. No:123, Kadıköy/İstanbul',
                phone: '(0216) 555 11 22',
                email: 'info@merkezoto.com',
                website: 'www.merkezoto.com',
                workingHours: 'Pazartesi - Cumartesi: 08:00 - 19:00, Pazar: Kapalı',
                rating: 4.8,
                categories: ['Motor', 'Bakım', 'Elektrik'],
                reviews: 45,
                images: ['/images/business1.jpg', '/images/business2.jpg']
            };
            
            const demoServices = [
                {
                    id: 1,
                    name: 'Yağ Değişimi',
                    description: 'Motor yağı ve filtre değişimi. En kaliteli yağlar kullanılır.',
                    price: 750,
                    duration: 30
                },
                {
                    id: 2,
                    name: 'Periyodik Bakım',
                    description: 'Aracınızın periyodik bakımı. Filtrelerin değişimi, sıvıların kontrolü ve tamamlanması.',
                    price: 1500,
                    duration: 120
                },
                {
                    id: 3,
                    name: 'Fren Bakımı',
                    description: 'Fren balataları değişimi ve fren hidroliği kontrolü.',
                    price: 1200,
                    duration: 60
                },
                {
                    id: 4,
                    name: 'Akü Değişimi',
                    description: 'Eski akünüzün yenisiyle değiştirilmesi ve şarj sistemi kontrolü.',
                    price: 2000,
                    duration: 20
                },
                {
                    id: 5,
                    name: 'Klima Bakımı',
                    description: 'Klima gazı dolumu ve klima sistemi temizliği.',
                    price: 800,
                    duration: 45
                }
            ];
            
            const demoReviews = [
                {
                    id: 1,
                    userId: 2,
                    user: { name: 'Ahmet Yılmaz' },
                    rating: 5,
                    comment: 'Çok profesyonel bir hizmet aldım. Aracım zamanında hazır oldu ve herhangi bir sorun yaşamadım. Teşekkürler!',
                    createdAt: '2023-05-15T14:30:00Z'
                },
                {
                    id: 2,
                    userId: 3,
                    user: { name: 'Zeynep Kaya' },
                    rating: 4,
                    comment: 'Bakım kalitesi çok iyi, fiyatlar da uygun. Tek eksik bekleme alanının konforunun biraz daha artırılabilir olması.',
                    createdAt: '2023-06-10T09:15:00Z'
                },
                {
                    id: 3,
                    userId: 4,
                    user: { name: 'Mehmet Demir' },
                    rating: 5,
                    comment: 'Aracımın ihtiyacı olan bakımlar tam zamanında ve eksiksiz yapıldı. Ek bir ücret talep edilmedi, şeffaf bir hizmet.',
                    createdAt: '2023-07-22T11:45:00Z'
                },
                {
                    id: 4,
                    userId: 5,
                    user: { name: 'Ayşe Yıldız' },
                    rating: 3,
                    comment: 'Hizmet kalitesi iyi ancak randevu saatine uyulmadı, 1 saat kadar beklemek zorunda kaldım.',
                    createdAt: '2023-08-05T16:20:00Z'
                }
            ];
            
            // İşletme bilgilerini yükle
            async function loadBusinessDetails() {
                try {
                    loadingSpinner.style.display = 'block';
                    
                    // İşletme detaylarını göster
                    setTimeout(() => {
                        displayBusinessDetails(demoBusiness);
                        loadingSpinner.style.display = 'none';
                    }, 500);
                } catch (error) {
                    loadingSpinner.style.display = 'none';
                    showAlert('İşletme bilgileri yüklenirken bir hata oluştu: ' + error.message, 'danger');
                }
            }
            
            // İşletme bilgilerini görüntüle
            function displayBusinessDetails(business) {
                const businessHTML = `
                    <div class="business-header">
                        <h1>${business.name}</h1>
                        <div class="business-rating">
                            <span class="rating-value">${business.rating ? business.rating.toFixed(1) : 'Yeni'}</span>
                            <span class="rating-stars">
                                ${generateStars(business.rating || 0)}
                            </span>
                            <span class="reviews-count">(${business.reviews || 0} değerlendirme)</span>
                        </div>
                    </div>
                    
                    <div class="business-info">
                        <div class="business-info-left">
                            <div class="business-description">
                                ${business.description}
                            </div>
                            <div class="business-categories">
                                ${(business.categories || []).map(category => 
                                    `<span class="category-tag">${category}</span>`
                                ).join('')}
                            </div>
                        </div>
                        <div class="business-info-right">
                            <div class="business-contact">
                                <div class="contact-item">
                                    <strong>Adres:</strong>
                                    <p>${business.address}</p>
                                </div>
                                <div class="contact-item">
                                    <strong>Telefon:</strong>
                                    <p>${business.phone}</p>
                                </div>
                                <div class="contact-item">
                                    <strong>E-posta:</strong>
                                    <p>${business.email}</p>
                                </div>
                                ${business.website ? `
                                <div class="contact-item">
                                    <strong>Web Sitesi:</strong>
                                    <p><a href="https://${business.website}" target="_blank">${business.website}</a></p>
                                </div>` : ''}
                                <div class="contact-item">
                                    <strong>Çalışma Saatleri:</strong>
                                    <p>${business.workingHours}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                businessDetailEl.innerHTML = businessHTML;
                
                // Servis ve değerlendirmeleri yükle
                displayServices(demoServices);
                displayReviews(demoReviews);
                
                // Randevu formu oluştur
                createAppointmentForm(business.id);
                
                // Değerlendirme formu oluştur
                createReviewForm(business.id);
            }
            
            // Hizmetleri görüntüle
            function displayServices(services) {
                if (!services || services.length === 0) {
                    servicesContainerEl.innerHTML = '<p>Bu işletme için henüz hizmet bilgisi bulunmamaktadır.</p>';
                    return;
                }
                
                let servicesHTML = '<div class="services-grid">';
                
                services.forEach(service => {
                    servicesHTML += `
                        <div class="service-card">
                            <h3>${service.name}</h3>
                            <p>${service.description}</p>
                            <div class="service-info">
                                <span class="service-price">${service.price.toLocaleString('tr-TR')} ₺</span>
                                <span class="service-duration">${service.duration} dk.</span>
                            </div>
                            <button class="btn btn-primary btn-block select-service-btn" 
                                data-service-id="${service.id}" 
                                data-service-name="${service.name}" 
                                data-service-price="${service.price}" 
                                data-service-duration="${service.duration}">
                                Bu Hizmeti Seç
                            </button>
                        </div>
                    `;
                });
                
                servicesHTML += '</div>';
                servicesContainerEl.innerHTML = servicesHTML;
                
                // Hizmet seçme butonlarına olay dinleyicileri ekle
                document.querySelectorAll('.select-service-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const serviceId = e.target.dataset.serviceId;
                        const serviceName = e.target.dataset.serviceName;
                        const servicePrice = e.target.dataset.servicePrice;
                        const serviceDuration = e.target.dataset.serviceDuration;
                        
                        // Seçilen hizmeti randevu formuna ekle
                        selectServiceForAppointment(serviceId, serviceName, servicePrice, serviceDuration);
                        
                        // Randevu bölümüne kaydır
                        document.getElementById('appointment-section').scrollIntoView({ behavior: 'smooth' });
                    });
                });
            }
            
            // Değerlendirmeleri görüntüle
            function displayReviews(reviews) {
                if (!reviews || reviews.length === 0) {
                    reviewsContainerEl.innerHTML = '<p>Bu işletme için henüz değerlendirme bulunmamaktadır.</p>';
                    return;
                }
                
                let reviewsHTML = '';
                
                reviews.forEach(review => {
                    const date = new Date(review.createdAt);
                    const formattedDate = `${date.getDate()}.${date.getMonth() + 1}.${date.getFullYear()}`;
                    
                    reviewsHTML += `
                        <div class="review-card">
                            <div class="review-header">
                                <span class="review-author">${review.user.name}</span>
                                <div class="review-rating">
                                    ${generateStars(review.rating)}
                                </div>
                                <span class="review-date">${formattedDate}</span>
                            </div>
                            <div class="review-content">
                                <p>${review.comment}</p>
                            </div>
                        </div>
                    `;
                });
                
                reviewsContainerEl.innerHTML = reviewsHTML;
            }
            
            // Yıldız oluştur
            function generateStars(rating) {
                const fullStars = Math.floor(rating);
                const halfStar = rating % 1 >= 0.5;
                const emptyStars = 5 - fullStars - (halfStar ? 1 : 0);
                
                let starsHTML = '';
                
                for (let i = 0; i < fullStars; i++) {
                    starsHTML += '<span class="star full">★</span>';
                }
                
                if (halfStar) {
                    starsHTML += '<span class="star half">★</span>';
                }
                
                for (let i = 0; i < emptyStars; i++) {
                    starsHTML += '<span class="star empty">☆</span>';
                }
                
                return starsHTML;
            }
            
            // Randevu formu oluştur
            function createAppointmentForm(businessId) {
                appointmentFormContainerEl.innerHTML = `
                    <div class="login-required">
                        <p>Randevu oluşturmak için giriş yapmanız gerekmektedir.</p>
                        <a href="/login.html?redirect=business.html%3Fid%3D${businessId}" class="btn btn-primary">Giriş Yap</a>
                        <a href="/register.html" class="btn btn-secondary">Kayıt Ol</a>
                    </div>
                `;
            }
            
            // Randevu için hizmet seç
            function selectServiceForAppointment(serviceId, serviceName, servicePrice, serviceDuration) {
                const selectedServiceEl = document.querySelector('.selected-service');
                if (selectedServiceEl) {
                    selectedServiceEl.innerHTML = `
                        <div class="selected-service-info">
                            <h4>${serviceName}</h4>
                            <div class="service-details">
                                <span class="detail-price">${parseInt(servicePrice).toLocaleString('tr-TR')} ₺</span>
                                <span class="detail-duration">${serviceDuration} dk.</span>
                            </div>
                        </div>
                        <p>Hizmet seçildi. Devam etmek için lütfen giriş yapın.</p>
                    `;
                    selectedServiceEl.dataset.serviceId = serviceId;
                }
            }
            
            // Değerlendirme formu oluştur
            function createReviewForm(businessId) {
                reviewFormContainerEl.innerHTML = `
                    <div class="login-required">
                        <p>Değerlendirme yapmak için giriş yapmanız gerekmektedir.</p>
                        <a href="/login.html?redirect=business.html%3Fid%3D${businessId}" class="btn btn-primary">Giriş Yap</a>
                        <a href="/register.html" class="btn btn-secondary">Kayıt Ol</a>
                    </div>
                `;
            }
            
            // Hata mesajı göster
            function showAlert(message, type = 'info') {
                const alertHTML = `<div class="alert alert-${type}">${message}</div>`;
                alertContainer.innerHTML = alertHTML;
                
                // 5 saniye sonra uyarıyı kaldır
                setTimeout(() => {
                    alertContainer.innerHTML = '';
                }, 5000);
            }
            
            // Sayfayı yükle
            loadBusinessDetails();
        });
    </script>
</body>
</html> 
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>İşletme Detayları - Arabamon</title>
    <link rel="stylesheet" href="/css/style.css">
    <!-- API JS -->
    <script src="/js/api.js"></script>
    <style>
        :root {
            --primary-color: #0066cc;
            --secondary-color: #ff6600;
            --dark-color: #333333;
            --light-color: #f4f4f4;
            --danger-color: #dc3545;
            --success-color: #28a745;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background-color: #f8f9fa;
            color: #333;
        }

        a {
            text-decoration: none;
            color: var(--primary-color);
        }

        ul {
            list-style: none;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* Navbar */
        .navbar {
            background-color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 1rem 0;
            margin-bottom: 2rem;
        }

        .navbar .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar-brand a {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .navbar-links {
            display: flex;
            margin: 0;
            padding: 0;
        }

        .navbar-links li {
            margin-left: 1.5rem;
        }

        .navbar-links li a {
            color: var(--dark-color);
            transition: color 0.3s;
        }

        .navbar-links li a:hover, 
        .navbar-links li a.active {
            color: var(--primary-color);
        }

        /* Business Detail Styles */
        .business-detail {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .business-header {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #eee;
        }

        .business-header h1 {
            font-size: 2rem;
            color: var(--primary-color);
            margin-right: 1rem;
            margin-bottom: 0.5rem;
        }

        .business-rating {
            display: flex;
            align-items: center;
            color: #666;
        }

        .rating-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-right: 0.5rem;
        }

        .rating-stars {
            margin-right: 0.5rem;
        }

        .star {
            color: #ffcc00;
            margin-right: -3px;
        }

        .star.empty {
            color: #ddd;
        }

        .reviews-count {
            color: #666;
            font-size: 0.9rem;
        }

        .business-info {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
        }

        @media (max-width: 768px) {
            .business-info {
                grid-template-columns: 1fr;
            }
        }

        .business-description {
            margin-bottom: 1.5rem;
            line-height: 1.8;
        }

        .business-categories {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .category-tag {
            background-color: var(--light-color);
            padding: 0.3rem 0.6rem;
            border-radius: 20px;
            font-size: 0.8rem;
            color: var(--dark-color);
        }

        .business-contact {
            background-color: var(--light-color);
            padding: 1.5rem;
            border-radius: 8px;
        }

        .contact-item {
            margin-bottom: 1rem;
        }

        .contact-item:last-child {
            margin-bottom: 0;
        }

        .contact-item strong {
            display: block;
            margin-bottom: 0.3rem;
            color: var(--dark-color);
        }

        .contact-item p {
            color: #666;
        }

        /* Services Styles */
        .business-services,
        .appointment-section,
        .reviews-section {
            margin-bottom: 3rem;
        }

        .business-services h2,
        .appointment-section h2,
        .reviews-section h2 {
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            color: var(--primary-color);
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--light-color);
        }

        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .service-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            transition: transform 0.3s;
        }

        .service-card:hover {
            transform: translateY(-5px);
        }

        .service-card h3 {
            font-size: 1.3rem;
            margin-bottom: 1rem;
            color: var(--dark-color);
        }

        .service-card p {
            color: #666;
            margin-bottom: 1rem;
        }

        .service-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .service-price {
            font-weight: bold;
            color: var(--primary-color);
        }

        .service-duration {
            color: #666;
        }

        /* Appointment Styles */
        .selected-service {
            background-color: var(--light-color);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }

        .selected-service-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .selected-service-info h4 {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: var(--dark-color);
        }

        .service-details {
            display: flex;
            gap: 1rem;
            font-size: 0.9rem;
        }

        .detail-price {
            font-weight: bold;
            color: var(--primary-color);
        }

        .detail-duration {
            color: #666;
        }

        .time-slots-container {
            margin: 1.5rem 0;
        }

        .time-slots-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 0.8rem;
            margin-top: 0.8rem;
        }

        .time-slot {
            position: relative;
        }

        .time-slot input[type="radio"] {
            display: none;
        }

        .time-slot label {
            display: block;
            padding: 0.6rem;
            text-align: center;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .time-slot label:hover {
            border-color: var(--primary-color);
        }

        .time-slot input[type="radio"]:checked + label {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .time-slot.unavailable label {
            background-color: #f8f9fa;
            color: #aaa;
            cursor: not-allowed;
            text-decoration: line-through;
        }

        /* Review Styles */
        .review-form-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .rating-input {
            display: flex;
            flex-direction: row-reverse;
            justify-content: flex-end;
            margin-bottom: 1rem;
        }

        .rating-input input[type="radio"] {
            display: none;
        }

        .rating-input label {
            display: inline-block;
            padding: 0.5rem;
            font-size: 1.5rem;
            color: #ddd;
            cursor: pointer;
            transition: color 0.3s;
        }

        .rating-input label:hover,
        .rating-input label:hover ~ label,
        .rating-input input[type="radio"]:checked ~ label {
            color: #ffcc00;
        }

        .review-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .review-author {
            font-weight: bold;
            color: var(--dark-color);
            margin-right: 1rem;
        }

        .review-rating {
            margin-right: 1rem;
        }

        .review-date {
            color: #888;
            font-size: 0.9rem;
        }

        .review-content {
            color: #666;
            line-height: 1.6;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: var(--dark-color);
        }

        .form-group input[type="text"],
        .form-group input[type="date"],
        .form-group input[type="email"],
        .form-group textarea {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            font-family: inherit;
        }

        .form-group textarea {
            resize: vertical;
        }

        .form-group small {
            display: block;
            margin-top: 0.5rem;
            color: #888;
            font-size: 0.8rem;
        }

        /* Button Styles */
        .btn {
            display: inline-block;
            padding: 0.8rem 1.5rem;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s ease;
            font-size: 1rem;
            text-align: center;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #0055b3;
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover {
            background-color: #e55c00;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
        }

        .btn-outline:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        .btn:disabled {
            background-color: #aaa;
            cursor: not-allowed;
        }

        /* Login Required */
        .login-required {
            background-color: var(--light-color);
            padding: 2rem;
            text-align: center;
            border-radius: 8px;
        }

        .login-required p {
            margin-bottom: 1.5rem;
            color: #666;
        }

        .login-required .btn {
            margin: 0 0.5rem;
        }

        /* Loading and Alerts */
        .loading-spinner {
            width: 40px;
            height: 40px;
            margin: 2rem auto;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }

        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
        }

        .alert-warning {
            background-color: #fff3cd;
            color: #856404;
        }

        /* Footer */
        footer {
            background-color: var(--dark-color);
            color: white;
            padding: 3rem 0 1rem;
            margin-top: 4rem;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .footer-section h3 {
            margin-bottom: 1rem;
            font-size: 1.2rem;
            color: #fff;
        }

        .footer-section p {
            margin-bottom: 0.5rem;
            color: #ddd;
        }

        .footer-section ul li {
            margin-bottom: 0.5rem;
        }

        .footer-section a {
            color: #ddd;
            transition: color 0.3s;
        }

        .footer-section a:hover {
            color: white;
        }

        .footer-bottom {
            text-align: center;
            padding-top: 1rem;
            border-top: 1px solid #555;
            color: #aaa;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .navbar .container {
                flex-direction: column;
            }
            
            .navbar-links {
                margin-top: 1rem;
            }
            
            .navbar-links li {
                margin: 0 0.5rem;
            }
            
            .business-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .business-rating {
                margin-top: 1rem;
            }
            
            .review-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .review-author, .review-rating {
                margin-bottom: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="container">
                <div class="navbar-brand">
                    <a href="/">Arabamon</a>
                </div>
                <ul class="navbar-links">
                    <li><a href="/">Ana Sayfa</a></li>
                    <li><a href="/businesses.html">İşletmeler</a></li>
                    <li><a href="/about.html">Hakkımızda</a></li>
                </ul>
                <ul class="navbar-links navbar-right">
                    <li><a href="/login.html">Giriş</a></li>
                    <li><a href="/register.html">Kayıt Ol</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <div class="container">
        <div class="alert-container"></div>
        
        <div class="loading-spinner" id="loading-spinner"></div>
        
        <div class="business-detail" id="business-detail">
            <!-- İşletme detayları buraya yüklenecek -->
        </div>
        
        <div class="business-services" id="business-services">
            <h2>Verilen Hizmetler</h2>
            <div class="services-container" id="services-container">
                <!-- Hizmetler buraya yüklenecek -->
            </div>
        </div>
        
        <div class="appointment-section" id="appointment-section">
            <h2>Randevu Al</h2>
            <div id="appointment-form-container">
                <!-- Randevu formu buraya yüklenecek -->
            </div>
        </div>
        
        <div class="reviews-section">
            <h2>Değerlendirmeler</h2>
            <div class="review-form-container" id="review-form-container">
                <!-- Değerlendirme formu buraya yüklenecek -->
            </div>
            <div class="reviews-container" id="reviews-container">
                <!-- Değerlendirmeler buraya yüklenecek -->
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Arabamon</h3>
                    <p>Araç bakım ve servis hizmetleri platformu.</p>
                </div>
                <div class="footer-section">
                    <h3>Hızlı Linkler</h3>
                    <ul>
                        <li><a href="/">Ana Sayfa</a></li>
                        <li><a href="/businesses.html">İşletmeler</a></li>
                        <li><a href="/about.html">Hakkımızda</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>İletişim</h3>
                    <p>info@arabamon.com</p>
                    <p>+90 555 123 4567</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2023 Arabamon. Tüm hakları saklıdır.</p>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const businessId = urlParams.get('id');
            
            if (!businessId) {
                window.location.href = '/businesses.html';
                return;
            }
            
            const businessDetailEl = document.getElementById('business-detail');
            const servicesContainerEl = document.getElementById('services-container');
            const appointmentFormContainerEl = document.getElementById('appointment-form-container');
            const reviewFormContainerEl = document.getElementById('review-form-container');
            const reviewsContainerEl = document.getElementById('reviews-container');
            const loadingSpinner = document.getElementById('loading-spinner');
            const alertContainer = document.querySelector('.alert-container');
            
            // Demo verileri
            const demoBusiness = {
                id: businessId,
                name: 'Merkez Oto Servis',
                description: 'Tüm araç markalarına profesyonel bakım ve onarım hizmeti sunuyoruz. 20 yıllık tecrübemizle aracınızın her türlü bakım, onarım ve parça değişimini en kaliteli şekilde yapıyoruz. Müşteri memnuniyetini en üst seviyede tutmak için çalışıyoruz.',
                address: 'Atatürk Cad. No:123, Kadıköy/İstanbul',
                phone: '(0216) 555 11 22',
                email: 'info@merkezoto.com',
                website: 'www.merkezoto.com',
                workingHours: 'Pazartesi - Cumartesi: 08:00 - 19:00, Pazar: Kapalı',
                rating: 4.8,
                categories: ['Motor', 'Bakım', 'Elektrik'],
                reviews: 45,
                images: ['/images/business1.jpg', '/images/business2.jpg']
            };
            
            const demoServices = [
                {
                    id: 1,
                    name: 'Yağ Değişimi',
                    description: 'Motor yağı ve filtre değişimi. En kaliteli yağlar kullanılır.',
                    price: 750,
                    duration: 30
                },
                {
                    id: 2,
                    name: 'Periyodik Bakım',
                    description: 'Aracınızın periyodik bakımı. Filtrelerin değişimi, sıvıların kontrolü ve tamamlanması.',
                    price: 1500,
                    duration: 120
                },
                {
                    id: 3,
                    name: 'Fren Bakımı',
                    description: 'Fren balataları değişimi ve fren hidroliği kontrolü.',
                    price: 1200,
                    duration: 60
                },
                {
                    id: 4,
                    name: 'Akü Değişimi',
                    description: 'Eski akünüzün yenisiyle değiştirilmesi ve şarj sistemi kontrolü.',
                    price: 2000,
                    duration: 20
                },
                {
                    id: 5,
                    name: 'Klima Bakımı',
                    description: 'Klima gazı dolumu ve klima sistemi temizliği.',
                    price: 800,
                    duration: 45
                }
            ];
            
            const demoReviews = [
                {
                    id: 1,
                    userId: 2,
                    user: { name: 'Ahmet Yılmaz' },
                    rating: 5,
                    comment: 'Çok profesyonel bir hizmet aldım. Aracım zamanında hazır oldu ve herhangi bir sorun yaşamadım. Teşekkürler!',
                    createdAt: '2023-05-15T14:30:00Z'
                },
                {
                    id: 2,
                    userId: 3,
                    user: { name: 'Zeynep Kaya' },
                    rating: 4,
                    comment: 'Bakım kalitesi çok iyi, fiyatlar da uygun. Tek eksik bekleme alanının konforunun biraz daha artırılabilir olması.',
                    createdAt: '2023-06-10T09:15:00Z'
                },
                {
                    id: 3,
                    userId: 4,
                    user: { name: 'Mehmet Demir' },
                    rating: 5,
                    comment: 'Aracımın ihtiyacı olan bakımlar tam zamanında ve eksiksiz yapıldı. Ek bir ücret talep edilmedi, şeffaf bir hizmet.',
                    createdAt: '2023-07-22T11:45:00Z'
                },
                {
                    id: 4,
                    userId: 5,
                    user: { name: 'Ayşe Yıldız' },
                    rating: 3,
                    comment: 'Hizmet kalitesi iyi ancak randevu saatine uyulmadı, 1 saat kadar beklemek zorunda kaldım.',
                    createdAt: '2023-08-05T16:20:00Z'
                }
            ];
            
            // İşletme bilgilerini yükle
            async function loadBusinessDetails() {
                try {
                    loadingSpinner.style.display = 'block';
                    
                    // İşletme detaylarını göster
                    setTimeout(() => {
                        displayBusinessDetails(demoBusiness);
                        loadingSpinner.style.display = 'none';
                    }, 500);
                } catch (error) {
                    loadingSpinner.style.display = 'none';
                    showAlert('İşletme bilgileri yüklenirken bir hata oluştu: ' + error.message, 'danger');
                }
            }
            
            // İşletme bilgilerini görüntüle
            function displayBusinessDetails(business) {
                const businessHTML = `
                    <div class="business-header">
                        <h1>${business.name}</h1>
                        <div class="business-rating">
                            <span class="rating-value">${business.rating ? business.rating.toFixed(1) : 'Yeni'}</span>
                            <span class="rating-stars">
                                ${generateStars(business.rating || 0)}
                            </span>
                            <span class="reviews-count">(${business.reviews || 0} değerlendirme)</span>
                        </div>
                    </div>
                    
                    <div class="business-info">
                        <div class="business-info-left">
                            <div class="business-description">
                                ${business.description}
                            </div>
                            <div class="business-categories">
                                ${(business.categories || []).map(category => 
                                    `<span class="category-tag">${category}</span>`
                                ).join('')}
                            </div>
                        </div>
                        <div class="business-info-right">
                            <div class="business-contact">
                                <div class="contact-item">
                                    <strong>Adres:</strong>
                                    <p>${business.address}</p>
                                </div>
                                <div class="contact-item">
                                    <strong>Telefon:</strong>
                                    <p>${business.phone}</p>
                                </div>
                                <div class="contact-item">
                                    <strong>E-posta:</strong>
                                    <p>${business.email}</p>
                                </div>
                                ${business.website ? `
                                <div class="contact-item">
                                    <strong>Web Sitesi:</strong>
                                    <p><a href="https://${business.website}" target="_blank">${business.website}</a></p>
                                </div>` : ''}
                                <div class="contact-item">
                                    <strong>Çalışma Saatleri:</strong>
                                    <p>${business.workingHours}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                businessDetailEl.innerHTML = businessHTML;
                
                // Servis ve değerlendirmeleri yükle
                displayServices(demoServices);
                displayReviews(demoReviews);
                
                // Randevu formu oluştur
                createAppointmentForm(business.id);
                
                // Değerlendirme formu oluştur
                createReviewForm(business.id);
            }
            
            // Hizmetleri görüntüle
            function displayServices(services) {
                if (!services || services.length === 0) {
                    servicesContainerEl.innerHTML = '<p>Bu işletme için henüz hizmet bilgisi bulunmamaktadır.</p>';
                    return;
                }
                
                let servicesHTML = '<div class="services-grid">';
                
                services.forEach(service => {
                    servicesHTML += `
                        <div class="service-card">
                            <h3>${service.name}</h3>
                            <p>${service.description}</p>
                            <div class="service-info">
                                <span class="service-price">${service.price.toLocaleString('tr-TR')} ₺</span>
                                <span class="service-duration">${service.duration} dk.</span>
                            </div>
                            <button class="btn btn-primary btn-block select-service-btn" 
                                data-service-id="${service.id}" 
                                data-service-name="${service.name}" 
                                data-service-price="${service.price}" 
                                data-service-duration="${service.duration}">
                                Bu Hizmeti Seç
                            </button>
                        </div>
                    `;
                });
                
                servicesHTML += '</div>';
                servicesContainerEl.innerHTML = servicesHTML;
                
                // Hizmet seçme butonlarına olay dinleyicileri ekle
                document.querySelectorAll('.select-service-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const serviceId = e.target.dataset.serviceId;
                        const serviceName = e.target.dataset.serviceName;
                        const servicePrice = e.target.dataset.servicePrice;
                        const serviceDuration = e.target.dataset.serviceDuration;
                        
                        // Seçilen hizmeti randevu formuna ekle
                        selectServiceForAppointment(serviceId, serviceName, servicePrice, serviceDuration);
                        
                        // Randevu bölümüne kaydır
                        document.getElementById('appointment-section').scrollIntoView({ behavior: 'smooth' });
                    });
                });
            }
            
            // Değerlendirmeleri görüntüle
            function displayReviews(reviews) {
                if (!reviews || reviews.length === 0) {
                    reviewsContainerEl.innerHTML = '<p>Bu işletme için henüz değerlendirme bulunmamaktadır.</p>';
                    return;
                }
                
                let reviewsHTML = '';
                
                reviews.forEach(review => {
                    const date = new Date(review.createdAt);
                    const formattedDate = `${date.getDate()}.${date.getMonth() + 1}.${date.getFullYear()}`;
                    
                    reviewsHTML += `
                        <div class="review-card">
                            <div class="review-header">
                                <span class="review-author">${review.user.name}</span>
                                <div class="review-rating">
                                    ${generateStars(review.rating)}
                                </div>
                                <span class="review-date">${formattedDate}</span>
                            </div>
                            <div class="review-content">
                                <p>${review.comment}</p>
                            </div>
                        </div>
                    `;
                });
                
                reviewsContainerEl.innerHTML = reviewsHTML;
            }
            
            // Yıldız oluştur
            function generateStars(rating) {
                const fullStars = Math.floor(rating);
                const halfStar = rating % 1 >= 0.5;
                const emptyStars = 5 - fullStars - (halfStar ? 1 : 0);
                
                let starsHTML = '';
                
                for (let i = 0; i < fullStars; i++) {
                    starsHTML += '<span class="star full">★</span>';
                }
                
                if (halfStar) {
                    starsHTML += '<span class="star half">★</span>';
                }
                
                for (let i = 0; i < emptyStars; i++) {
                    starsHTML += '<span class="star empty">☆</span>';
                }
                
                return starsHTML;
            }
            
            // Randevu formu oluştur
            function createAppointmentForm(businessId) {
                appointmentFormContainerEl.innerHTML = `
                    <div class="login-required">
                        <p>Randevu oluşturmak için giriş yapmanız gerekmektedir.</p>
                        <a href="/login.html?redirect=business.html%3Fid%3D${businessId}" class="btn btn-primary">Giriş Yap</a>
                        <a href="/register.html" class="btn btn-secondary">Kayıt Ol</a>
                    </div>
                `;
            }
            
            // Randevu için hizmet seç
            function selectServiceForAppointment(serviceId, serviceName, servicePrice, serviceDuration) {
                const selectedServiceEl = document.querySelector('.selected-service');
                if (selectedServiceEl) {
                    selectedServiceEl.innerHTML = `
                        <div class="selected-service-info">
                            <h4>${serviceName}</h4>
                            <div class="service-details">
                                <span class="detail-price">${parseInt(servicePrice).toLocaleString('tr-TR')} ₺</span>
                                <span class="detail-duration">${serviceDuration} dk.</span>
                            </div>
                        </div>
                        <p>Hizmet seçildi. Devam etmek için lütfen giriş yapın.</p>
                    `;
                    selectedServiceEl.dataset.serviceId = serviceId;
                }
            }
            
            // Değerlendirme formu oluştur
            function createReviewForm(businessId) {
                reviewFormContainerEl.innerHTML = `
                    <div class="login-required">
                        <p>Değerlendirme yapmak için giriş yapmanız gerekmektedir.</p>
                        <a href="/login.html?redirect=business.html%3Fid%3D${businessId}" class="btn btn-primary">Giriş Yap</a>
                        <a href="/register.html" class="btn btn-secondary">Kayıt Ol</a>
                    </div>
                `;
            }
            
            // Hata mesajı göster
            function showAlert(message, type = 'info') {
                const alertHTML = `<div class="alert alert-${type}">${message}</div>`;
                alertContainer.innerHTML = alertHTML;
                
                // 5 saniye sonra uyarıyı kaldır
                setTimeout(() => {
                    alertContainer.innerHTML = '';
                }, 5000);
            }
            
            // Sayfayı yükle
            loadBusinessDetails();
        });
    </script>
</body>
</html> 